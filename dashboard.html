<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíé ProfitPal Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1e3a5f 50%, #2c5f2d 100%);
            min-height: 100vh;
            color: #ffffff;
            overflow-x: hidden;
        }

        /* Animated background */
        .background-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .floating-shape {
            position: absolute;
            background: linear-gradient(135deg, rgba(50, 205, 50, 0.1), rgba(255, 215, 0, 0.05));
            border-radius: 50%;
            animation: float 20s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(100px, -100px) rotate(90deg); }
            50% { transform: translate(-50px, -200px) rotate(180deg); }
            75% { transform: translate(-150px, -50px) rotate(270deg); }
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, rgba(15, 35, 65, 0.9), rgba(30, 58, 95, 0.8));
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(34, 139, 34, 0.3);
            padding: 0 30px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
        }

        .logo {
            font-size: 24px;
            font-weight: 900;
            background: linear-gradient(135deg, #32cd32, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #32cd32, #228b22);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
        }

        .nav-menu {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .nav-item {
            color: #ecf0f1;
            text-decoration: none;
            font-weight: 500;
            padding: 10px 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(50, 205, 50, 0.1);
            color: #32cd32;
        }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
            z-index: 10;
            position: relative;
        }

        /* üî• REFERRAL BANNER - –ì–õ–ê–í–ù–ê–Ø –§–ò–ß–ê! */
        .referral-banner {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(50, 205, 50, 0.15));
            backdrop-filter: blur(20px);
            border: 3px solid rgba(255, 215, 0, 0.6);
            border-radius: 20px;
            padding: 25px 35px;
            margin-bottom: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .referral-banner:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(255, 215, 0, 0.3);
            border-color: #ffd700;
        }

        .referral-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.2), transparent);
            transition: left 0.5s;
        }

        .referral-banner:hover::before {
            left: 100%;
        }

        .referral-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .referral-main {
            flex: 1;
        }

        .referral-title {
            font-size: 20px;
            font-weight: 800;
            color: #ffd700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .referral-link {
            font-family: 'Courier New', monospace;
            font-size: 16px;
            color: #ffffff;
            background: rgba(0, 0, 0, 0.3);
            padding: 12px 16px;
            border-radius: 10px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            word-break: break-all;
            margin: 10px 0;
            position: relative;
        }

        .copy-hint {
            font-size: 14px;
            color: #87ceeb;
            font-style: italic;
            margin-top: 5px;
        }

        .referral-stats {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .referral-stat {
            text-align: center;
            padding: 15px;
            background: rgba(50, 205, 50, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(50, 205, 50, 0.3);
            min-width: 120px;
        }

        .stat-number-large {
            font-size: 28px;
            font-weight: 900;
            color: #32cd32;
            display: block;
            line-height: 1;
        }

        .stat-label-small {
            font-size: 12px;
            color: #87ceeb;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 5px;
        }

        .free-months-highlight {
            background: linear-gradient(135deg, #32cd32, #228b22) !important;
            color: white !important;
        }

        .free-months-highlight .stat-number-large {
            color: white !important;
        }

        .free-months-highlight .stat-label-small {
            color: rgba(255, 255, 255, 0.8) !important;
        }

        /* üî• BOOST DEVELOPMENT BANNER */
        .boost-banner {
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.2), rgba(255, 193, 7, 0.15));
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 107, 53, 0.5);
            border-radius: 15px;
            padding: 20px 25px;
            margin-bottom: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .boost-banner:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.2);
            border-color: #ff6b35;
        }

        .boost-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .boost-title {
            font-size: 18px;
            font-weight: 800;
            color: #ff6b35;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .boost-subtitle {
            font-size: 14px;
            color: #ffffff;
            font-weight: 400;
        }

        .boost-expand-hint {
            font-size: 14px;
            color: #87ceeb;
            font-style: italic;
        }

        .boost-options {
            background: linear-gradient(135deg, rgba(30, 58, 95, 0.4), rgba(15, 35, 65, 0.6));
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid rgba(255, 107, 53, 0.3);
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .donation-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .donation-btn {
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(255, 193, 7, 0.05));
            border: 2px solid rgba(255, 107, 53, 0.3);
            border-radius: 12px;
            padding: 20px 15px;
            color: #ffffff;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .donation-btn:hover {
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.2), rgba(255, 193, 7, 0.1));
            border-color: #ff6b35;
            transform: translateY(-2px);
        }

        .donation-btn .price {
            display: block;
            font-size: 20px;
            color: #ff6b35;
            margin-top: 5px;
        }

        .custom-donation {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(44, 62, 80, 0.3);
            border: 2px solid rgba(255, 107, 53, 0.3);
            border-radius: 12px;
            padding: 20px 15px;
            color: #ffffff;
            font-weight: 600;
            justify-content: center;
        }

        .custom-donation input {
            background: transparent;
            border: none;
            color: #ffffff;
            font-size: 18px;
            font-weight: bold;
            width: 80px;
            text-align: center;
        }

        .custom-donation input:focus {
            outline: none;
        }

        .currency {
            font-size: 20px;
            color: #ff6b35;
        }

        .donation-agreement {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(44, 62, 80, 0.2);
            border-radius: 8px;
        }

        .donation-agreement input[type="checkbox"] {
            transform: scale(1.2);
            accent-color: #ff6b35;
        }

        .donation-submit {
            width: 100%;
            background: linear-gradient(135deg, #ff6b35, #e74c3c);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .donation-submit:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.3);
        }

        .donation-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Copy Success Animation */
        .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #32cd32, #228b22);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 600;
            z-index: 1000;
            animation: copyFeedback 2s ease-out;
        }

        @keyframes copyFeedback {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }

        /* Welcome Section */
        .welcome-section {
            background: linear-gradient(135deg, rgba(30, 58, 95, 0.4), rgba(15, 35, 65, 0.6));
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            border: 2px solid rgba(34, 139, 34, 0.3);
            position: relative;
            overflow: hidden;
        }

        .welcome-content {
            position: relative;
            z-index: 2;
        }

        .welcome-title {
            font-size: 36px;
            font-weight: 900;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #ffffff, #32cd32);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-subtitle {
            font-size: 18px;
            color: #bdc3c7;
            margin-bottom: 20px;
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(44, 62, 80, 0.3);
            border-radius: 12px;
            border: 1px solid rgba(34, 139, 34, 0.2);
        }

        .stat-number {
            font-size: 24px;
            font-weight: 900;
            color: #32cd32;
            display: block;
        }

        .stat-label {
            font-size: 12px;
            color: #95a5a6;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: linear-gradient(135deg, rgba(30, 58, 95, 0.4), rgba(15, 35, 65, 0.6));
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid rgba(34, 139, 34, 0.3);
            transition: all 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(50, 205, 50, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: #ffffff;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #32cd32, #228b22);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        /* Quick Analysis */
        .analysis-input {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .ticker-input {
            flex: 1;
            padding: 15px 20px;
            background: rgba(44, 62, 80, 0.3);
            border: 2px solid rgba(34, 139, 34, 0.2);
            border-radius: 12px;
            color: #ffffff;
            font-size: 16px;
            text-transform: uppercase;
        }

        .ticker-input:focus {
            outline: none;
            border-color: #32cd32;
        }

        .analyze-btn {
            background: linear-gradient(135deg, #32cd32, #228b22);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(50, 205, 50, 0.3);
        }

        /* Portfolio Table */
        .portfolio-table {
            width: 100%;
            border-collapse: collapse;
        }

        .portfolio-table th,
        .portfolio-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(34, 139, 34, 0.2);
        }

        .portfolio-table th {
            color: #32cd32;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .portfolio-table td {
            color: #ecf0f1;
        }

        .positive { color: #32cd32; }
        .negative { color: #e74c3c; }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .action-btn {
            padding: 12px 20px;
            border: 2px solid rgba(34, 139, 34, 0.3);
            background: rgba(44, 62, 80, 0.3);
            color: #32cd32;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
            flex: 1;
        }

        .action-btn:hover {
            background: rgba(50, 205, 50, 0.1);
            border-color: #32cd32;
            transform: translateY(-2px);
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #32cd32, #228b22);
            border-color: #32cd32;
            color: white;
        }

        /* Recommendations */
        .recommendation-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(44, 62, 80, 0.3);
            border-radius: 10px;
            border-left: 4px solid #32cd32;
        }

        .recommendation-content h4 {
            color: #ffffff;
            margin-bottom: 5px;
        }

        .recommendation-content p {
            color: #95a5a6;
            font-size: 14px;
        }

        .recommendation-badge {
            background: linear-gradient(135deg, #32cd32, #228b22);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        /* üî• REFERRAL FRIENDS LIST */
        .referral-friends {
            background: linear-gradient(135deg, rgba(30, 58, 95, 0.4), rgba(15, 35, 65, 0.6));
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            border: 2px solid rgba(34, 139, 34, 0.3);
        }

        .friends-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .next-billing-info {
            color: #32cd32;
            font-weight: 600;
            font-size: 14px;
            padding: 8px 15px;
            background: rgba(50, 205, 50, 0.1);
            border-radius: 20px;
            border: 1px solid rgba(50, 205, 50, 0.3);
        }

        .friend-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 8px;
            background: rgba(44, 62, 80, 0.3);
            border-radius: 10px;
            border-left: 4px solid #ffd700;
        }

        .friend-email {
            color: #ffffff;
            font-weight: 500;
        }

        .friend-date {
            color: #95a5a6;
            font-size: 14px;
        }

        .friend-reward {
            background: linear-gradient(135deg, #ffd700, #ffed4a);
            color: #0a0e27;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }

        .progress-section {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 12px;
        }

        .progress-bar-container {
            background: rgba(0,0,0,0.3);
            height: 8px;
            border-radius: 4px;
            margin: 10px 0;
            position: relative;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(135deg, #32cd32, #228b22);
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .main-container {
                padding: 20px;
            }

            .header-content {
                padding: 0 20px;
            }

            .nav-menu {
                display: none;
            }

            .referral-content {
                flex-direction: column;
                gap: 20px;
            }

            .referral-stats {
                flex-direction: row;
                gap: 15px;
                justify-content: center;
            }

            .referral-stat {
                min-width: 100px;
            }

            .friends-header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }

            .donation-grid {
                grid-template-columns: 1fr 1fr;
            }

            .boost-content {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
        }
        /* üî• PRO/DOWNGRADE BANNER STYLES */
            .pro-banner, .downgrade-banner {
                background: linear-gradient(135deg, rgba(255, 107, 53, 0.2), rgba(255, 193, 7, 0.15));
                backdrop-filter: blur(20px);
                border: 2px solid rgba(255, 107, 53, 0.5);
                border-radius: 15px;
                padding: 20px 25px;
                margin-bottom: 25px;
                cursor: pointer;
                transition: all 0.3s ease;
                position: relative;
            }

            .downgrade-banner {
                background: linear-gradient(135deg, rgba(135, 206, 235, 0.2), rgba(95, 158, 160, 0.15));
                border-color: rgba(135, 206, 235, 0.5);
            }

            .pro-banner:hover, .downgrade-banner:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 30px rgba(255, 107, 53, 0.2);
                border-color: #ff6b35;
            }

            .downgrade-banner:hover {
                box-shadow: 0 10px 30px rgba(135, 206, 235, 0.2);
                border-color: #87ceeb;
            }

            .pro-options, .downgrade-options {
                background: linear-gradient(135deg, rgba(30, 58, 95, 0.4), rgba(15, 35, 65, 0.6));
                backdrop-filter: blur(20px);
                border-radius: 15px;
                padding: 25px;
                margin-bottom: 25px;
                border: 2px solid rgba(255, 107, 53, 0.3);
                animation: slideDown 0.3s ease-out;
            }

            .downgrade-options {
                border-color: rgba(135, 206, 235, 0.3);
            }
        </style>
</head>
    <body>
      <script src="/pp-auth.js"></script>
      <script>
        ensureSessionOrRedirect().then(me => {
          document.body.classList.toggle('admin-mode', !!me.is_admin);
          window.PP_USER = me; // –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è –≤ –¥—Ä—É–≥–∏—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö
          // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ø—Ä–æ—Å—Ç–∞–≤–∏–º data-–∞—Ç—Ä–∏–±—É—Ç –Ω–∞ <html>
          document.documentElement.dataset.isAdmin = me.is_admin ? '1' : '0';
        });
      </script>

        <link rel="stylesheet" href="/admin.css">
        <script src="/pp-admin.js"></script>


    <!-- Background Animation -->
    <div class="background-animation">
        <div class="floating-shape" style="width: 100px; height: 100px; top: 10%; left: 80%; animation-delay: 0s;"></div>
        <div class="floating-shape" style="width: 150px; height: 150px; top: 60%; left: 10%; animation-delay: 5s;"></div>
        <div class="floating-shape" style="width: 80px; height: 80px; top: 30%; left: 60%; animation-delay: 10s;"></div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">üíé ProfitPal</div>

            <nav class="nav-menu">
                <a href="#" class="nav-item active">Dashboard</a>
                <a href="#" class="nav-item">Analysis</a>
                <a href="#" class="nav-item">Portfolio</a>
                <a href="#" class="nav-item">Settings</a>
            </nav>

            <div class="user-info">
                <div class="user-avatar" id="user-avatar">DJ</div>
                <span id="user-greeting">Welcome back!</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-container">
        <!-- üî• REFERRAL BANNER - –ì–õ–ê–í–ù–ê–Ø –§–ò–ß–ê! -->
        <div class="referral-banner" onclick="copyReferralLink()" title="Click to copy referral link">
            <div class="referral-content">
                <div class="referral-main">
                    <div class="referral-title">
                        üîó Your Personal Referral Link
                        <span style="font-size: 14px; background: rgba(255, 215, 0, 0.2); padding: 4px 8px; border-radius: 10px;">EARN FREE MONTHS!</span>
                    </div>
                    <div class="referral-link" id="referral-link">
                        https://profitpal.org?ref=LOADING...
                    </div>
                    <div class="copy-hint">üí° Click anywhere on this banner to copy your referral link!</div>
                </div>

                <div class="referral-stats">
                    <div class="referral-stat free-months-highlight">
                        <span class="stat-number-large" id="free-months-count">0</span>
                        <span class="stat-label-small">FREE MONTHS</span>
                    </div>
                    <div class="referral-stat">
                        <span class="stat-number-large" id="paid-friends-count">0</span>
                        <span class="stat-label-small">FRIENDS PAID</span>
                    </div>
                    <div class="referral-stat">
                        <span class="stat-number-large" id="money-saved">$0.00</span>
                        <span class="stat-label-small">MONEY SAVED</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- üî• BOOST DEVELOPMENT BANNER -->
        <div class="boost-banner" id="boostBanner" onclick="toggleBoostOptions()">
            <div class="boost-content">
                <div class="boost-title">
                    ‚ö° BOOST DEVELOPMENT
                    <span class="boost-subtitle">Support innovation & get premium features faster</span>
                </div>
                <div class="boost-expand-hint">Click to expand options ‚Üí</div>
            </div>
        </div>

        <!-- Expanded Donation Options -->
        <div class="boost-options" id="boostOptions" style="display:none;">
          <div class="donation-grid" id="donationTiles">
            <button type="button" class="donation-btn" data-amount="3"  data-type="coffee">
              ‚òï Developer's Coffee<br><span class="price">$3</span>
            </button>

            <button type="button" class="donation-btn" data-amount="5"  data-type="milk">
              ü•õ Coffee with Milk<br><span class="price">$5</span>
            </button>

            <button type="button" class="donation-btn" data-amount="10" data-type="features">
              ‚ú® New Features<br><span class="price">$10</span>
            </button>

              <div class="custom-donation">    <!-- ‚Üê –ø—Ä–æ—Å—Ç–æ –±–ª–æ–∫, –ù–ï –ø–ª–∏—Ç–∫–∞ -->
                ‚ù§Ô∏è Custom Amount:
                <input id="customAmount" inputmode="numeric" pattern="\d*" placeholder="0">
                <span class="currency">$</span>
              </div>
          </div>

          <div class="donation-agreement" style="margin-top:12px;">
            <input type="checkbox" id="donationConsent" />
            <label for="donationConsent">I authorize this transaction</label>
          </div>

          <button class="donation-submit" id="submitDonation" disabled style="width:100%;margin-top:12px;">
            BOOST NOW
          </button>
        </div>

        <!-- üî• PRO SUBSCRIPTION BANNER -->
        <div class="pro-banner" id="proBanner" onclick="toggleProOptions()" style="display: none;">
            <div class="boost-content">
                <div class="boost-title">
                    üöÄ PRO SUBSCRIPTION
                    <span class="boost-subtitle">Upgrade to advanced options trading & analytics</span>
                </div>
                <div class="boost-expand-hint">Click to expand upgrade options ‚Üí</div>
            </div>
        </div>

        <!-- PRO Upgrade Options -->
        <div class="pro-options" id="proOptions" style="display: none;">
            <div style="background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(50, 205, 50, 0.05)); border-radius: 15px; padding: 25px; margin-bottom: 20px; border: 2px solid rgba(255, 107, 53, 0.3);">
                <h3 style="color: #ff6b35; margin-bottom: 15px;">üöÄ PRO Package Features ($49.99/month)</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div style="color: #ffffff;">‚úÖ Real-time Options Analysis</div>
                    <div style="color: #ffffff;">üìä Live Greeks Dashboard</div>
                    <div style="color: #ffffff;">üéØ Options Strategies Simulator</div>
                    <div style="color: #ffffff;">‚ö° Volatility Spike Alerts</div>
                    <div style="color: #ffffff;">üìà Paper Trading Simulation</div>
                    <div style="color: #ffffff;">üî• Unusual Options Activity</div>
                </div>
            </div>

            <div id="prorationInfo" style="background: rgba(255, 215, 0, 0.1); border: 2px solid #ffd700; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                <h4 style="color: #ffd700; margin-bottom: 10px;">üí∞ Proration Calculation</h4>
                <div style="color: #ffffff; font-size: 14px;" id="prorationDetails">
                    <!-- Proration details will be calculated here -->
                </div>
            </div>

            <div class="donation-agreement">
                <input type="checkbox" id="proConsent" onchange="toggleProSubmitButton()">
                <label for="proConsent">I authorize payment processing and subscription upgrade</label>
            </div>

            <button class="donation-submit" id="submitProUpgrade" disabled onclick="processProUpgrade()" style="background: linear-gradient(135deg, #ff6b35, #e74c3c);">
                UPGRADE TO PRO ($49.99/month)
            </button>
        </div>

        <!-- üî• DOWNGRADE BANNER -->
        <div class="downgrade-banner" id="downgradeBanner" onclick="toggleDowngradeOptions()" style="display: none;">
            <div class="boost-content">
                <div class="boost-title">
                    ‚¨áÔ∏è RETURN TO STANDARD
                    <span class="boost-subtitle">Downgrade from PRO to Standard subscription</span>
                </div>
                <div class="boost-expand-hint">Click to expand downgrade options ‚Üí</div>
            </div>
        </div>

        <!-- Downgrade Options -->
        <div class="downgrade-options" id="downgradeOptions" style="display: none;">
            <div style="background: linear-gradient(135deg, rgba(135, 206, 235, 0.1), rgba(95, 158, 160, 0.05)); border-radius: 15px; padding: 25px; margin-bottom: 20px; border: 2px solid rgba(135, 206, 235, 0.3);">
                <h3 style="color: #87ceeb; margin-bottom: 15px;">‚¨áÔ∏è Standard Subscription ($14.99/month)</h3>
                <div style="color: #ffffff; margin-bottom: 20px;">
                    <div>‚úÖ Real-time Market Data</div>
                    <div>‚úÖ Server Maintenance</div>
                    <div>‚úÖ Basic Stock Analysis</div>
                    <div>‚ùå Options Trading Features</div>
                    <div>‚ùå Advanced Analytics</div>
                </div>
            </div>

            <div id="downgradeProrationInfo" style="background: rgba(135, 206, 235, 0.1); border: 2px solid #87ceeb; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                <h4 style="color: #87ceeb; margin-bottom: 10px;">üí∞ Refund Calculation</h4>
                <div style="color: #ffffff; font-size: 14px;" id="downgradeProrationDetails">
                    <!-- Downgrade proration details will be calculated here -->
                </div>
            </div>

            <div class="donation-agreement">
                <input type="checkbox" id="downgradeConsent" onchange="toggleDowngradeSubmitButton()">
                <label for="downgradeConsent">I authorize subscription downgrade and refund processing</label>
            </div>

            <button class="donation-submit" id="submitDowngrade" disabled onclick="processDowngrade()" style="background: linear-gradient(135deg, #87ceeb, #5f9ea0);">
                DOWNGRADE TO STANDARD ($14.99/month)
            </button>
        </div>

        <!-- Welcome Section -->
        <section class="welcome-section">
            <div class="welcome-content">
                <h1 class="welcome-title" id="welcome-title">Welcome back, Investor! üíé</h1>
                <p class="welcome-subtitle">Your AI-powered stock analysis dashboard is ready. Let's find your next winning investment!</p>

                <div class="quick-stats">
                    <div class="stat-item">
                        <span class="stat-number">47</span>
                        <span class="stat-label">Stocks Analyzed</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">12</span>
                        <span class="stat-label">Diamonds Found</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">+23.5%</span>
                        <span class="stat-label">Avg Returns</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">$125K</span>
                        <span class="stat-label">Portfolio Value</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Quick Analysis -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h3 class="card-title">Quick Stock Analysis</h3>
                    <div class="card-icon">üöÄ</div>
                </div>

                <div class="analysis-input">
                    <input type="text" class="ticker-input" placeholder="Enter ticker (e.g., AAPL)" id="quickTicker">
                    <button class="analyze-btn" onclick="quickAnalysis()">Analyze</button>
                </div>

                <div id="quickResults" style="display: none;">
                    <div style="padding: 20px; background: rgba(50, 205, 50, 0.1); border-radius: 10px; border-left: 4px solid #32cd32;">
                        <h4 style="color: #32cd32; margin-bottom: 10px;">üíé AAPL Analysis Complete!</h4>
                        <p style="color: #ecf0f1; margin-bottom: 5px;">Current Price: $175.43</p>
                        <p style="color: #ecf0f1; margin-bottom: 5px;">Intrinsic Value: $198.20</p>
                        <p style="color: #32cd32; font-weight: 600;">Verdict: UNDERVALUED (+13%)</p>
                    </div>
                </div>

                <div class="action-buttons">
                    <a href="javascript:goToFullAnalysis()" class="action-btn">Full Analysis</a>
                    <a href="#" class="action-btn primary">Add to Portfolio</a>
                </div>
            </div>

            <!-- Portfolio Overview -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h3 class="card-title">Portfolio Overview</h3>
                    <div class="card-icon">üìà</div>
                </div>

                <table class="portfolio-table">
                    <thead>
                        <tr>
                            <th>Stock</th>
                            <th>Value</th>
                            <th>Change</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>AAPL</td>
                            <td>$35,240</td>
                            <td class="positive">+2.3%</td>
                        </tr>
                        <tr>
                            <td>MSFT</td>
                            <td>$28,900</td>
                            <td class="positive">+1.8%</td>
                        </tr>
                        <tr>
                            <td>GOOGL</td>
                            <td>$22,150</td>
                            <td class="negative">-0.5%</td>
                        </tr>
                        <tr>
                            <td>NVDA</td>
                            <td>$18,750</td>
                            <td class="positive">+4.2%</td>
                        </tr>
                    </tbody>
                </table>

                <div class="action-buttons">
                    <a href="#" class="action-btn">View All Holdings</a>
                    <a href="#" class="action-btn">Rebalance</a>
                </div>
            </div>
        </div>

        <!-- Today's Recommendations -->
        <div class="dashboard-card">
            <div class="card-header">
                <h3 class="card-title">Today's AI Recommendations</h3>
                <div class="card-icon">‚≠ê</div>
            </div>

            <div class="recommendation-item">
                <div class="recommendation-content">
                    <h4>Tesla (TSLA) - Strong Buy Signal</h4>
                    <p>P/E ratio improved, debt levels decreased, intrinsic value indicates 18% upside potential</p>
                </div>
                <div class="recommendation-badge">BUY</div>
            </div>

            <div class="recommendation-item">
                <div class="recommendation-content">
                    <h4>Netflix (NFLX) - Potential Diamond</h4>
                    <p>Undervalued by 22% based on DCF analysis, strong fundamentals, low debt ratio</p>
                </div>
                <div class="recommendation-badge">DIAMOND</div>
            </div>

            <div class="recommendation-item">
                <div class="recommendation-content">
                    <h4>Meta (META) - Monitor Closely</h4>
                    <p>Mixed signals: good valuation but high P/E ratio, requires deeper analysis</p>
                </div>
                <div class="recommendation-badge">WATCH</div>
            </div>

            <div class="action-buttons">
                <a href="#" class="action-btn primary">Get Full Report</a>
                <a href="#" class="action-btn">Customize Alerts</a>
            </div>
        </div>

        <!-- üî• REFERRAL FRIENDS SECTION -->
        <div class="referral-friends" id="referral-friends-section" style="display: none;">
            <div class="friends-header">
                <h3 class="card-title">üéâ Your Successful Referrals</h3>
                <div class="next-billing-info" id="next-billing-info">Next billing: FREE!</div>
            </div>

            <div id="friends-list">
                <!-- Friends will be loaded dynamically -->
            </div>

            <div class="progress-section">
                <h4 style="color: #ffd700; margin-bottom: 10px;">üéØ Referral Goal Progress</h4>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progress-bar" style="width: 0%;"></div>
                </div>
                <p style="color: #87ceeb; margin: 0;" id="progress-text">
                    0 of 12 friends joined ‚Ä¢ 12 more for a FREE YEAR! üéÅ
                </p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer style="text-align: center; padding: 30px 20px; margin-top: 50px; border-top: 1px solid rgba(34, 139, 34, 0.2); color: #95a5a6; font-size: 14px;">
        ¬© 2025 ProfitPal. A product of Denava LLC. All rights reserved.
    </footer>

        <script>
        'use strict';

        /* ========= helpers ========= */
        async function apiGet(url) {
          const r = await fetch(url, { credentials: 'include' });
          if (!r.ok) throw new Error(`${r.status} ${r.statusText}`);
          return r.json();
        }
        async function apiPost(url, data) {
          const r = await fetch(url, {
            method: 'POST',
            credentials: 'include',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data || {})
          });
          if (!r.ok) {
            let detail = '';
            try { detail = (await r.json()).detail || ''; } catch {}
            throw new Error(`${r.status} ${r.statusText} ${detail}`.trim());
          }
          return r.json();
        }

        /* ========= session bootstrap =========
           –ë—ã—Å—Ç—Ä–æ –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ–º /api/session/me –∏ –ø—Ä–æ—Å—Ç–∞–≤–ª—è–µ–º PP_USER + data-is-admin
        */
        async function waitForSession(timeoutMs = 2500) {
          const started = Date.now();
          try {
            const res = await fetch('/api/session/me', { credentials: 'include' });
            if (res.ok) {
              const me = await res.json();
              if (me && me.id) {
                window.PP_USER = me;
                document.documentElement.dataset.isAdmin = me.is_admin ? '1' : '0';
                return me;
              }
            }
          } catch {}
          while (Date.now() - started < timeoutMs && !(window.PP_USER && window.PP_USER.id)) {
            await new Promise(r => setTimeout(r, 150));
          }
          if (window.PP_USER) {
            document.documentElement.dataset.isAdmin = window.PP_USER.is_admin ? '1' : '0';
          }
          return window.PP_USER || null;
        }

        /* ========= session utils ========= */
        function isAdmin() {
          return !!(window.PP_USER && window.PP_USER.is_admin);
        }
        function getUserEmail() {
          if (window.PP_USER?.email) return window.PP_USER.email;
          const urlEmail = new URLSearchParams(location.search).get('email');
          return urlEmail || null;
        }

        /* ========= referral demo/state ========= */
        let userData = {
          fullName: "Loading...",
          email: "loading@example.com",
          referralLink: "https://profitpal.org?ref=LOADING...",
          freeMonthsBalance: 0,
          totalPaidReferrals: 0,
          totalEarnedMonths: 0,
          recentReferrals: []
        };

        function showDemoData() {
          const email = getUserEmail() || 'dj@profitpal.org';
          if (isAdmin()) {
            userData = {
              fullName: "System Administrator",
              email,
              referralLink: "https://profitpal.org?ref=ADMIN-SYSTEM-ACCESS",
              freeMonthsBalance: 999,
              totalPaidReferrals: 0,
              totalEarnedMonths: 0,
              recentReferrals: []
            };
          } else {
            userData = {
              fullName: "DJ Investor",
              email,
              referralLink: "https://profitpal.org?ref=ABCDE12345fghij",
              freeMonthsBalance: 3,
              totalPaidReferrals: 3,
              totalEarnedMonths: 3,
              recentReferrals: [
                { new_user_email: "alex.smith@gmail.com",  used_at: "2025-01-03" },
                { new_user_email: "sarah.jones@yahoo.com", used_at: "2025-01-01" },
                { new_user_email: "mike.wilson@gmail.com", used_at: "2024-12-28" }
              ]
            };
          }
          updateUI();
        }

        async function loadUserData() {
          try {
            await waitForSession(1500);
            if (!getUserEmail()) { showDemoData(); return; }

            const res = await fetch('/api/referral-stats/me', { credentials: 'include' });
            const ct = res.headers.get('content-type') || '';
            if (!ct.includes('application/json')) { showDemoData(); return; }

            const data = await res.json();
            if (data?.error) { showDemoData(); return; }

            if (data.referral_info) {
              userData.referralLink       = data.referral_info.referral_link;
              userData.freeMonthsBalance  = data.referral_info.free_months_balance;
              userData.totalPaidReferrals = data.referral_info.total_referrals;
              userData.totalEarnedMonths  = data.referral_info.total_earned_months;
            }
            if (data.recent_referrals) userData.recentReferrals = data.recent_referrals;

            updateUI();
          } catch (e) {
            console.log('Referral API unavailable, using demo:', e);
            showDemoData();
          }
        }

        /* ========= UI ========= */
        function updateUI() {
          const freeMonths  = Number(userData.freeMonthsBalance || 0);
          const paidFriends = Number(userData.totalPaidReferrals || 0);
          const moneySaved  = Number(userData.totalEarnedMonths || 0) * 9.99;

          const $ref   = document.getElementById('referral-link');
          const $free  = document.getElementById('free-months-count');
          const $paid  = document.getElementById('paid-friends-count');
          const $saved = document.getElementById('money-saved');

          if ($ref)  $ref.textContent  = userData.referralLink || '';
          if ($free) $free.textContent = freeMonths;
          if ($paid) $paid.textContent = paidFriends;
          if ($saved)$saved.textContent = `$${moneySaved.toFixed(2)}`;

          const avatarEl = document.getElementById('user-avatar');
          const greetEl  = document.getElementById('user-greeting');
          const first    = (userData.fullName || '').split(' ')[0] || 'User';

          if (!isAdmin()) {
            const initials = (userData.fullName || '')
              .split(' ').filter(Boolean).map(s => s[0]).join('');
            if (avatarEl) avatarEl.textContent = initials || 'üôÇ';
            if (greetEl)  greetEl.textContent  = `Welcome back, ${first}!`;
            updateGreeting(first);
          } else {
            updateGreeting('Admin');
          }

          const friendsSection = document.getElementById('referral-friends-section');
          if (friendsSection) {
            if (paidFriends > 0) {
              friendsSection.style.display = 'block';
              updateProgress();
              updateNextBilling();
            } else {
              friendsSection.style.display = 'none';
            }
          }
        }

        function updateProgress() {
          const current = userData.totalPaidReferrals;
          const target = 12;
          const pct = Math.min((current / target) * 100, 100);
          const bar = document.getElementById('progress-bar');
          if (bar) bar.style.width = `${pct}%`;
          const txt = document.getElementById('progress-text');
          if (txt) txt.textContent =
            `${current} of ${target} friends joined ‚Ä¢ ${Math.max(target - current, 0)} more for a FREE YEAR! üéÅ`;
        }
        function updateNextBilling() {
          const freeMonths = userData.freeMonthsBalance;
          const el = document.getElementById('next-billing-info');
          if (!el) return;
          if (freeMonths > 0) {
            el.textContent = `Next ${freeMonths} billing${freeMonths > 1 ? 's' : ''}: FREE!`;
            el.style.background = 'rgba(50, 205, 50, 0.1)';
            el.style.color = '#32cd32';
          } else {
            el.textContent = 'Next billing: $9.99 on 1st';
            el.style.background = 'rgba(255, 107, 53, 0.1)';
            el.style.color = '#ff6b35';
          }
        }

        /* ========= banners: upgrade/downgrade ========= */
        function updateSubscriptionBanners() {
          const plan = (window.PP_USER?.plan_type || 'early_bird').toLowerCase();
          const show = (id, on) => { const n = document.getElementById(id); if (n) n.style.display = on ? 'block' : 'none'; };
          if (plan === 'pro') { show('proBanner', false); show('downgradeBanner', true); }
          else { show('proBanner', true); show('downgradeBanner', false); }
        }
        function toggleProOptions() {
          const options = document.getElementById('proOptions');
          const banner  = document.getElementById('proBanner');
          if (!options || !banner) return;
          const open = options.style.display !== 'block';
          options.style.display = open ? 'block' : 'none';
          banner.querySelector('.boost-expand-hint').textContent =
            open ? 'Click to collapse ‚Üë' : 'Click to expand upgrade options ‚Üí';
          if (open) calculateProration('upgrade');
        }
        function toggleDowngradeOptions() {
          const options = document.getElementById('downgradeOptions');
          const banner  = document.getElementById('downgradeBanner');
          if (!options || !banner) return;
          const open = options.style.display !== 'block';
          options.style.display = open ? 'block' : 'none';
          banner.querySelector('.boost-expand-hint').textContent =
            open ? 'Click to collapse ‚Üë' : 'Click to expand downgrade options ‚Üí';
          if (open) calculateProration('downgrade');
        }
        function calculateProration(type) {
          const today = new Date();
          const daysInMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
          const daysUsed = today.getDate() - 1;
          const daysRemaining = daysInMonth - daysUsed;

          if (type === 'upgrade') {
            const currentPrice = 9.99, newPrice = 49.99;
            const refund    = (currentPrice / daysInMonth) * daysRemaining;
            const newCharge = (newPrice    / daysInMonth) * daysRemaining;
            const total     = newCharge - refund;
            const box = document.getElementById('prorationDetails');
            if (box) box.innerHTML = `
              <div>üìÖ Current month: ${daysUsed} days used, ${daysRemaining} remaining (${daysInMonth} total)</div>
              <div>üí∏ Refund for unused Early Bird: $${refund.toFixed(2)}</div>
              <div>üí≥ Charge for PRO remainder: $${newCharge.toFixed(2)}</div>
              <div style="font-weight:700;color:#ffd700;margin-top:10px;">üí∞ Total charge today: $${total.toFixed(2)}</div>`;
          } else {
            const currentPrice = 49.99, newPrice = 14.99;
            const refund   = (currentPrice / daysInMonth) * daysRemaining;
            const charge   = (newPrice    / daysInMonth) * daysRemaining;
            const totalRef = refund - charge;
            const box = document.getElementById('downgradeProrationDetails');
            if (box) box.innerHTML = `
              <div>üìÖ Current month: ${daysUsed} days used, ${daysRemaining} remaining (${daysInMonth} total)</div>
              <div>üí∏ Refund for unused PRO: $${refund.toFixed(2)}</div>
              <div>üí≥ Charge for Standard remainder: $${charge.toFixed(2)}</div>
              <div style="font-weight:700;color:#87ceeb;margin-top:10px;">üí∞ Total refund: $${totalRef.toFixed(2)}</div>`;
          }
        }

        /* ========= donations ========= */
        let selectedDonationAmount = 0;
        let selectedDonationType   = '';

        function getConsentEl() {
          return document.getElementById('donationConsent') || document.getElementById('authorizeDonation');
        }
        function toggleBoostOptions() {
          const options = document.getElementById('boostOptions');
          const banner  = document.getElementById('boostBanner');
          if (!options || !banner) return;
          const open = options.style.display !== 'block';
          options.style.display = open ? 'block' : 'none';
          banner.querySelector('.boost-expand-hint').textContent =
            open ? 'Click to collapse ‚Üë' : 'Click to expand options ‚Üí';
        }
        function toggleSubmitButton() {
          const consent = !!getConsentEl()?.checked;
          const hasAmount = selectedDonationAmount > 0;
          const btn = document.getElementById('submitDonation');
          if (btn) btn.disabled = !(consent && hasAmount);
        }
        async function processDonation() {
          if (selectedDonationAmount <= 0) { alert('Please select a donation amount'); return; }
          const consentEl = getConsentEl();
          if (!consentEl || !consentEl.checked) { alert('Please check "I authorize this transaction"'); return; }

          const btn = document.getElementById('submitDonation');
          if (btn) { btn.textContent = 'Processing...'; btn.disabled = true; }

          try {
            await apiPost('/api/process-donation', {
              amount: selectedDonationAmount,
              type: selectedDonationType,
              authorized: true
            });
            showDonationSuccess();
            toggleBoostOptions();
            resetDonationForm();
          } catch (e) {
            console.error('Donation error:', e);
            alert('Donation failed. Please try again.');
          } finally {
            if (btn) { btn.textContent = 'BOOST NOW'; btn.disabled = false; }
          }
        }
        function showDonationSuccess() {
          const el = document.createElement('div');
          el.className = 'copy-success';
          let msg = 'üíé Thank you for supporting ProfitPal! ';
          if (selectedDonationType === 'coffee')   msg += 'I love black coffee, thank you! ‚òï';
          else if (selectedDonationType === 'milk') msg += 'Black coffee with milk ‚Äî wow! ü•õ';
          else if (selectedDonationType === 'features') msg += 'Features are coming! üöÄ';
          else msg += 'Huge thanks for recognizing my work! üíù';
          el.textContent = msg;
          document.body.appendChild(el);
          setTimeout(() => el.remove(), 4000);
        }
        function resetDonationForm() {
          selectedDonationAmount = 0;
          selectedDonationType   = '';
          const input = document.getElementById('customAmount');
          if (input) { input.value = ''; input.classList.remove('has-value'); }
          const consentEl = getConsentEl(); if (consentEl) consentEl.checked = false;
          document.querySelectorAll('.donation-btn').forEach(btn => btn.classList.remove('selected'));
          const btn = document.getElementById('submitDonation');
          if (btn) { btn.textContent = 'BOOST NOW'; btn.disabled = true; }
        }

        /* ===== DONATION: –±–µ–∑ inline-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ ===== */
        function _selectDonationTile(el) {
          document.querySelectorAll('.donation-btn').forEach(b => b.classList.remove('selected'));
          if (el) el.classList.add('selected');
        }
        function _onDonationTileClick(e) {
          const btn = e.target.closest('.donation-btn');
          if (!btn || !btn.isConnected) return;
          const amount = Number(btn.dataset.amount || '');
          const type   = btn.dataset.type || 'custom';
          if (!Number.isFinite(amount) || amount <= 0) return;

          selectedDonationAmount = amount;
          selectedDonationType   = type;

          const custom = document.getElementById('customAmount');
          if (custom) { custom.value = ''; custom.classList.remove('has-value'); }

          _selectDonationTile(btn);
          toggleSubmitButton();
        }
        function _onCustomAmountInput() {
          const el = document.getElementById('customAmount');
          const v  = parseInt(el?.value || '0', 10);
          if (v > 0) {
            selectedDonationAmount = v;
            selectedDonationType   = 'custom';
            el.classList.add('has-value');
            _selectDonationTile(null);
          } else {
            selectedDonationAmount = 0;
            el?.classList.remove('has-value');
          }
          toggleSubmitButton();
        }
        function _onDonationConsentChange() { toggleSubmitButton(); }
            // ---- –∫–ª–∏–∫–∏ –ø–æ —Ç–∞–π–ª–∞–º (—Ç–µ—Ä–ø–∏–º—ã –∫ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å—Ç–∫–µ –±–µ–∑ data-*) ----
            function _onDonationTileClick(e) {
              const btn = e.target.closest('.donation-btn');
              if (!btn || !btn.isConnected) return;

              // —Å—É–º–º–∞: —Å–Ω–∞—á–∞–ª–∞ –∏–∑ data-amount, –∏–Ω–∞—á–µ –∏–∑ —Ç–µ–∫—Å—Ç–∞ "$3/$5/$10"
              let amount = Number(btn.dataset.amount);
              if (!Number.isFinite(amount) || amount <= 0) {
                const m = (btn.textContent.match(/([0-9]+)/) || [])[1];
                amount = Number(m);
              }

              // —Ç–∏–ø: –∏–∑ data-type, –∏–Ω–∞—á–µ –ø–æ —Ç–µ–∫—Å—Ç—É
              const t = (btn.dataset.type || btn.textContent || '').toLowerCase();
              const type = t.includes('milk') ? 'milk' : t.includes('feature') ? 'features' : 'coffee';

              // –≤–∏–∑—É–∞–ª—å–Ω–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞
              document.querySelectorAll('.donation-btn').forEach(b => b.classList.remove('selected'));
              btn.classList.add('selected');

              if (Number.isFinite(amount) && amount > 0) {
                selectedDonationAmount = amount;
                selectedDonationType   = type;
                const custom = document.getElementById('customAmount');
                if (custom) { custom.value = ''; custom.classList.remove('has-value'); }
              } else {
                selectedDonationAmount = 0;
                selectedDonationType   = '';
              }

              toggleSubmitButton();
            }

            // ---- –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–Ω–∞—Ç–æ–≤ ----
            function initDonationUI() {
              // –∫–æ—Ä–µ–Ω—å –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: —Å–ø–µ—Ä–≤–∞ #donationTiles, –ø–æ—Ç–æ–º #boostOptions, –∏–Ω–∞—á–µ ‚Äî document
              const root =
                document.getElementById('donationTiles') ||
                document.getElementById('boostOptions') ||
                document;

              // 1) ¬´–≥–∏–¥—Ä–∏—Ä—É–µ–º¬ª —Å—Ç–∞—Ä—É—é —Ä–∞–∑–º–µ—Ç–∫—É: –¥–æ–±–∞–≤–∏–º data-amount / data-type, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
              document.querySelectorAll('.donation-btn').forEach(btn => {
                if (!btn.dataset.amount) {
                  const m = (btn.textContent.match(/([0-9]+)/) || [])[1];
                  if (m) btn.dataset.amount = m;
                }
                if (!btn.dataset.type) {
                  const t = (btn.textContent || '').toLowerCase();
                  btn.dataset.type = t.includes('milk') ? 'milk'
                                  :  t.includes('feature') ? 'features'
                                  :  'coffee';
                }
              });

              // 2) –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∏–∫–æ–≤ –ø–æ —Ç–∞–π–ª–∞–º
              root.addEventListener('click', _onDonationTileClick);

              // 3) –∫–∞—Å—Ç–æ–º–Ω–∞—è —Å—É–º–º–∞
              const custom = document.getElementById('customAmount');
              if (custom) custom.addEventListener('input', _onCustomAmountInput);

              // 4) —á–µ–∫–±–æ–∫—Å —Å–æ–≥–ª–∞—Å–∏—è
              const consent = getConsentEl(); // —Ç–≤–æ—è —Ñ—É–Ω–∫—Ü–∏—è
              if (consent) consent.addEventListener('change', _onDonationConsentChange);

              // 5) —Å–∞–±–º–∏—Ç
              const submit = document.getElementById('submitDonation');
              if (submit) submit.addEventListener('click', processDonation);

              // 6) –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫–Ω–æ–ø–∫—É –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ
              toggleSubmitButton();
            }

        /* ========= misc ========= */
        async function copyReferralLink() {
          try {
            await navigator.clipboard.writeText(userData.referralLink);
            const div = document.createElement('div');
            div.className = 'copy-success';
            div.innerHTML = 'üéâ Referral link copied! Share with friends! üíé';
            document.body.appendChild(div);
            setTimeout(() => div.remove(), 2000);
            const banner = document.querySelector('.referral-banner');
            if (banner) {
              banner.style.transform = 'translateY(-3px) scale(1.02)';
              banner.style.borderColor = '#32cd32';
              setTimeout(() => { banner.style.transform = ''; banner.style.borderColor = ''; }, 500);
            }
          } catch {
            const ta = document.createElement('textarea');
            ta.value = userData.referralLink; document.body.appendChild(ta);
            ta.select(); document.execCommand('copy'); ta.remove();
          }
        }
        function quickAnalysis() {
          const ticker = document.getElementById('quickTicker')?.value.toUpperCase().trim();
          if (!ticker) { alert('Please enter a ticker first'); return; }
          const btn = document.querySelector('.analyze-btn');
          const res = document.getElementById('quickResults');
          if (!btn || !res) return;
          btn.textContent = 'Analyzing...'; btn.disabled = true;
          setTimeout(() => {
            res.style.display = 'block';
            btn.textContent = 'Analyze'; btn.disabled = false;
            res.querySelector('h4').textContent = `üíé ${ticker} Analysis Complete!`;
            res.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          }, 1000);
        }
        document.getElementById('quickTicker')?.addEventListener('keypress', e => {
          if (e.key === 'Enter') quickAnalysis();
        });
        function updateGreeting(firstName='Investor') {
          const hour = new Date().getHours();
          const welcomeTitle = document.getElementById('welcome-title');
          if (!welcomeTitle) return;
          const time = hour < 12 ? 'Good morning' : hour < 18 ? 'Good afternoon' : 'Good evening';
          if (firstName === 'Admin') {
            welcomeTitle.innerHTML = `${time}, <span style="color:#ffd700;">Admin</span>! üëëüíé`;
          } else {
            welcomeTitle.textContent = `${time}, ${firstName}! üíé`;
          }
        }
        function animateFreeMonths() {
          const counter = document.getElementById('free-months-count');
          if (!counter) return;
          setInterval(() => {
            if (parseInt(counter.textContent || '0', 10) > 0) {
              counter.style.transform = 'scale(1.2)'; counter.style.color = '#ffd700';
              setTimeout(() => { counter.style.transform = 'scale(1)'; counter.style.color = 'white'; }, 300);
            }
          }, 15000);
        }

        /* ========= boot ========= */
        document.addEventListener('DOMContentLoaded', async () => {
          await waitForSession(2000);   // –ø–æ–¥–Ω–∏–º–µ–º PP_USER –∏ —Ñ–ª–∞–≥ –∞–¥–º–∏–Ω–∞ –¥–æ –ø–µ—Ä–≤–æ–≥–æ —Ä–∏—Å–æ–≤–∞–Ω–∏—è
          showDemoData();               // –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ Admin/User)
          loadUserData();               // –∑–∞—Ç–µ–º ‚Äî —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã
          animateFreeMonths();
          updateSubscriptionBanners();
          initDonationUI();

          // –ø–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫
          document.querySelectorAll('.dashboard-card, .referral-banner, .boost-banner').forEach((card, i) => {
            card.style.opacity = '0'; card.style.transform = 'translateY(20px)';
            setTimeout(() => {
              card.style.transition = 'all .6s ease';
              card.style.opacity = '1'; card.style.transform = 'translateY(0)';
            }, i * 200);
          });
        });

        // –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑ –≤ 5 –º–∏–Ω—É—Ç
        setInterval(loadUserData, 300000);
        </script>
        
        <script src="/donation-fix.js"></script>

</body>
</html>